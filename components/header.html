<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Navbar with Auth</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- FontAwesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
</head>

<body>
  <header>
     <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <a class="navbar-brand" href="../index.html" id="brand">
          <img src="/assests/images/LogoMainVector.png" alt="Logo" />
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link main-nav-link active" href="/">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link main-nav-link" href="./../about.html">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link main-nav-link" href="#footer">Contact Us</a>
            </li>
            <li class="nav-item d-none" id="dashboard">
              <a class="btn btn-dark" href="">dashboard</a>
            </li>
            <div class="d-flex gap-2"> 
   <li class="nav-item">
              <a class="nav-link" href="#"><i class="far fa-heart"></i></a>
            </li>
            <li class="nav-item">
              <a id="cart-icon" class="nav-link cart-icon-container" href="#">
                <i class="fas fa-shopping-cart"></i>
                <span id="cart-badge" class="cart-badge hidden">0</span>
              </a>
            </li>
            </div>
         

            <li id="authPlaceholder" class="nav-item d-flex align-items-center justify-content-center gap-1"></li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>

    const cart = document.getElementById("cart-icon");
    if (cart) {
      cart.addEventListener("click", (e) => {
        e.preventDefault();
        const currentUser = localStorage.getItem("currentUser");
        if (currentUser) {
          window.location.href = "../customer/cart.html";
        } else {
          document.body.insertAdjacentHTML(
            "afterbegin",
            `<div id="login-alert" class="alert alert-warning text-center" 
              style="position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:9999;">
          ! يجب عليك أولاً تسجيل الدخول إلى حسابك
        </div>`
          );

          setTimeout(() => {
            document.getElementById("login-alert")?.remove();
          }, 3000);
        }
      });
    }

    const navLinks = document.querySelectorAll(".navbar-nav .nav-link");
    const currentPage = window.location.pathname.split("/").pop();

    navLinks.forEach((link) => {
      const linkPage = link.getAttribute("href").split("/").pop();

      if (linkPage === currentPage) {
        link.classList.add("active");
      } else {
        link.classList.remove("active");
      }
    });


    function renderAuthButtons() {
      const authPlaceholder = document.getElementById("authPlaceholder");
      const currentUser = JSON.parse(localStorage.getItem("currentUser"));

      if (!authPlaceholder) return;

      if (currentUser) {
        // Dropdown لو فيه يوزر عامل لوجين
        authPlaceholder.innerHTML = `
        <li class="nav-item dropdown">
          <a 
            class="nav-link dropdown-toggle" 
            href="#" 
            role="button" 
            data-bs-toggle="dropdown" 
            aria-expanded="false">
            ${currentUser.name || "User"}
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="../profile.html">Profile</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a id="logoutBtn" class="dropdown-item" href="#">Logout</a></li>

          </ul>
        </li>
      `;

        // conditionally render the dahsboard button depending on the current user role 
        const dashboardBtn = document.querySelector('#dashboard');
        if (currentUser.role === 'seller') {
          dashboardBtn.firstElementChild.href = '/seller/seller-dashboard.html'
          dashboardBtn.classList.remove('d-none');
          
        } else if (currentUser.role === 'admin') {
         dashboardBtn.firstElementChild.href = '/admin/admin-dashboard.html'
          dashboardBtn.classList.remove('d-none');
        }
        // زرار اللوج اوت
        document.getElementById("logoutBtn").addEventListener("click", (e) => {
          e.preventDefault();
          localStorage.removeItem("currentUser");
          location.reload(); // ريفريش للصفحة بعد اللوج اوت
        });
      } else {
        // لو مفيش يوزر: Login/Register
        authPlaceholder.innerHTML = `
        <ul class="navbar-nav  d-flex flex-row gap-4"> 
        <li class="nav-item">
          <a class="nav-link btn btn-light" href="../login.html">Login</a>
        </li>
        <li class="nav-item">
          <a class="nav-link btn bg-dark text-light" href="../login.html">Register</a>
        </li>
        </ul>
      `;
      }
    }

    // اول ما الصفحة تفتح
    renderAuthButtons();
  </script>

</body>

</html>