<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="./assests/js/bootstrap.bundle.min.js" defer></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assests/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./assests/css/products-details.css" />
    <link rel="stylesheet" href="./components/style.css" />
    <link rel="stylesheet" href="/assests/css/style.css" />
    <link rel="stylesheet" href="./assests/css/cartBadge.css" />

    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <title>details</title>
    <script src="./assests/js/product-details.js" type="module"></script>
    <script type="module">
      import { loadComponent } from "./assests/js/utils.js";
      loadComponent("header", "./components/header.html");
      loadComponent("footer", "./components/footer.html");
      setTimeout(() => {
          import("./assests/js/cartBadge.js");
        }, 1000);
    </script>
  </head>
  <body>
    <header id="header"></header>
    <div class="main-container px-3 px-md-4">
      <section
        class="d-flex flex-column align-items-center flex-md-row justify-content-center s1"
      >
        <div class="left-sec d-flexalign-items-center justify-content-center">
          <div class="sub-cont-onephone h-100">
            <img src="./assests/imgs/phone.png" alt="" />
          </div>
        </div>
        <div class="right-sec">
          <h1>Apple iPhone 15 Pro Max</h1>
          <p class="price"><span class="priceDiscounted">$1199</span><del>$1299</del></p>

          <!-- <div
            class="typeOfProduct row d-flex flex-wrap justify-content-center justify-content-md-start px-3"
          >
            <div
              class="typeOfProduct-item col-12 col-md-2 d-flex align-items-center"
            >
              <input
                type="radio"
                name="typeOfProduct"
                id="typeOfProduct-1"
                checked
              />
              <label for="typeOfProduct-1">128GB</label>
            </div>
            <div
              class="typeOfProduct-item col-12 col-md-2 d-flex align-items-center"
            >
              <input type="radio" name="typeOfProduct" id="typeOfProduct-2" />
              <label for="typeOfProduct-2">256GB</label>
            </div>
            <div
              class="typeOfProduct-item col-12 col-md-2 d-flex align-items-center"
            >
              <input type="radio" name="typeOfProduct" id="typeOfProduct-3" />
              <label for="typeOfProduct-3">512GB</label>
            </div>
            <div
              class="typeOfProduct-item col-12 col-md-2 d-flex align-items-center"
            >
              <input type="radio" name="typeOfProduct" id="typeOfProduct-4" />
              <label for="typeOfProduct-4">1TB</label>
            </div>
          </div> -->

          <p class="my-3 px-2 pr-5">
            Enhanced capabilities thanks toan enlarged display of 6.7 inchesand
            work without rechargingthroughout the day. Incredible photosas in
            weak, yesand in bright lightusing the new systemwith two camera
            <span class="extra-text hidden">
              hhh-work without rechargingthroughout the day. Incredible photosas
              in weak, yesand in bright lightusing the new systemwith two
              camera-hhh</span
            >
            <span class="moreBtn">more</span>...
          </p>
          <div
            class="btnsWish_Cart d-flex flex-column flex-md-row justify-content-around my-4"
          >
            <!-- <button class="wishBtn w-100 btn">Add to Wishlist</button> -->
            <button class="cartBtn w-100 btn">Add to Cart</button>
          </div>

          <div class="row featuresOfProduct justify-content-around">
            <div class="col-5 d-flex flex-column align-items-center">
              <div
                class="feature-item d-flex flex-column flex-md-row justify-content-center align-items-center"
              >
                <i class="fa-solid fa-truck"></i>
                <div>
                  <p>Free Delevery</p>
                  <p>1-2 days</p>
                </div>
              </div>
            </div>
            <div class="col-5 d-flex flex-column align-items-center">
              <div
                class="feature-item d-flex flex-column flex-md-row justify-content-center align-items-center"
              >
                <i class="fa-solid fa-store"></i>
                <div>
                  <p>Stock Status</p>
                  <p>In-Stock</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="s2">
        <h5>Details</h5>
        <p>
          Lorem ipsum dolor sit, amet consectetur adipisicing elit. Vero vitae
          aperiam minima quisquam ratione quibusdam laborum corrupti atque
          doloremque consequuntur!
        </p>
        <h5>Screen</h5>
        <p class="d-flex justify-content-between">
          <span>Screen Diagonal</span>
          <span>6.7"</span>
        </p>
        <p class="d-flex justify-content-between">
          <span>Screen resolution</span>
          <span>2532 x 1170</span>
        </p>
        <p class="d-flex justify-content-between">
          <span>Screen refresh rate</span>
          <span>60Hz</span>
        </p>
        <p class="d-flex justify-content-between">
          <span>Pixel density</span>
          <span>460 ppi</span>
        </p>
        <p class="d-flex justify-content-between">
          <span>Screen type</span>
          <span> OLED</span>
        </p>
        <p class="d-flex justify-content-between">
          <span>Screen Diagonal</span>
          <span>6.7"</span>
        </p>
        <h5>CPU</h5>
        <p class="d-flex justify-content-between">
          <span>CPU</span>
          <span>A17 Bionic</span>
        </p>
        <p class="d-flex justify-content-between">
          <span>No. of Cores</span>
          <span>6</span>
        </p>
        <button class="btnView">View More</button>
      </section>
    </div>
    <footer id="footer"></footer>
     <script>
      const product = JSON.parse(localStorage.getItem("selectedProduct"));

    if (product) {
      let imgContainer = document.querySelector('.img-OfProduct');
      let productName = document.querySelector('.product-OfName');
      let priceContainer = document.querySelector('.price-OfProduct');
      let descriptionProduct = document.querySelector('.desk-OfProduct');
      let priceDiscounted = document.querySelector('.priceDiscounted');
      productName.textContent = product.name;
      imgContainer.src = product.image;
      priceContainer.textContent = `$${product.price}`;
      descriptionProduct.textContent = product.description;
      priceDiscounted.textContent = `$${product.price *= 0.8}`; // Assuming a discount of $100 for display purposes
      console.log(product);
      
    } else {
      document.getElementById("product-details").innerHTML = `
        <div class="alert alert-danger text-center">No product selected!</div>
      `;
    }

    //check if user is logged while adding to cart
    const AddToCart = document.getElementById("AddToCart-Btn");
    const currentUser = JSON.parse(localStorage.getItem("currentUser"));
    
    AddToCart.addEventListener("click", async () => {
        if (currentUser) {
            // Add product to cart
            const cart = JSON.parse(localStorage.getItem(`cart_${currentUser.id}`)) || [];
            
            // Check if product already exists in cart
            const existingItem = cart.find(item => item.id === product.id);
            
            if (existingItem) {
                // Update quantity if product exists
                existingItem.quantity += 1;
                if (existingItem.quantity > existingItem.stock) {
                    existingItem.quantity = existingItem.stock;
                }
            } else {
                // Add new product to cart
                cart.push({
                    ...product,
                    quantity: 1
                });
            }
            
            			// Save updated cart
			localStorage.setItem(`cart_${currentUser.id}`, JSON.stringify(cart));
			
			// Update cart badge
			try {
				const { cartBadgeManager } = await import('./assests/js/cartBadge.js');
				cartBadgeManager.addItemToCart();
			} catch (error) {
				console.log('Cart badge manager not available');
			}
			
			// Show success message
			document.body.insertAdjacentHTML(
				"afterbegin",
				`<div id="success-alert" class="alert alert-success text-center" 
				  style="position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:9999;">
					<i class="fas fa-check-circle me-2"></i>Product added to cart successfully!
				</div>`
			);

			setTimeout(() => {
				document.getElementById("success-alert")?.remove();
			}, 2000);
            
        } else {
            document.body.insertAdjacentHTML(
                "afterbegin",
                `<div id="login-alert" class="alert alert-warning text-center" 
                  style="position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:9999;">
                    <i class="fas fa-exclamation-triangle me-2"></i>يجب عليك أولاً تسجيل الدخول إلى حسابك
                </div>`
            );

            setTimeout(() => {
                document.getElementById("login-alert")?.remove();
            }, 3000);
        }
    });

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
